{% extends "fieldsight/fieldsight_base.html" %}
{% load i18n staticfiles %}
{% load filters %}

{% block page-title %}{% trans 'Site Dashboard' %}{% endblock %}
{%block extracss %}
    <link rel="stylesheet" href="{% static 'css/leaflet.css' %}">
    <link rel="stylesheet" href="{% static 'css/MarkerCluster.css' %}">
    <link rel="stylesheet" href="{% static 'css/MarkerCluster.Default.css' %}">
<style>
    .axis path,
.axis line {
  fill: none;
  stroke: #000;
  shape-rendering: crispEdges;
}

  .bar {
    fill: #296fd5;
}

.bar:hover {
  fill: rgba(41, 111, 213, 0.5);
}

.x.axis path {
  display: none;
}

.d3-tip {
  line-height: 1;
  font-weight: bold;
  padding: 12px;
  background: rgba(0, 0, 0, 0.8);
  color: #fff;
  border-radius: 2px;
}

/* Creates a small triangle extender for the tooltip */
.d3-tip:after {
  box-sizing: border-box;
  display: inline;
  font-size: 10px;
  width: 100%;
  line-height: 1;
  color: rgba(0, 0, 0, 0.8);
  content: "\25BC";
  position: absolute;
  text-align: center;
}

/* Style northward tooltips differently */
.d3-tip.n:after {
  margin: -1px 0 0 0;
  top: 100%;
  left: 0;
}

    path {
    stroke: steelblue;
    stroke-width: 2;
    fill: none;
}

</style>
{% endblock %}

{% block head %}
    <a class="setting-btn" href="{% url 'fieldsight:site-edit' obj.pk %}"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></a>
    
{% endblock %}

{% block breadcrumbs %}
 {% ifrole "Project" %}
    <li><a href="{% url 'fieldsight:project-dashboard' obj.project.pk %}">{{obj.project.name}}</a></li>
 {% endrole %}
    <li>{{obj.name}}</li>
{% endblock %}
{% block content %}





	<div class="organization-detail-page">


        <div class="organization-short-detail">
                <div class="org-grg">
                    <div class="col-md-3">
                        <div class="org-logo">
                            <img src="{{ obj.logo.url }}" title="{{ obj.logo}}" />
                        </div>
                    </div>
                    <div class="col-md-9">
                        <div class="abt-org">
                            <div class="col-md-6">
                              <h3>{{ obj.name }}</h3>
                              <h5>{{ obj.identifier }}</h5>
                              <p class="address"><span><i class="fa fa-map-marker" aria-hidden="true"></i></span>{{ obj.address }}</p>
                              
                              <p class="contact"><span><i class="fa fa-phone" aria-hidden="true"></i></span>{{ obj.phone }}</p>
                              <p class="fax"><span><i class="fa fa-fax" aria-hidden="true"></i></span>{{ obj.fax }}</p>
                              <p class="website"><span></span>{{ obj.website }}</p>
  							              <p class="short-detail">{{ obj.description }}</p>
                              <p class="progress-of-site">{% trans 'Progress' %}</p>
                                {% with progress=obj.progress %}
                                  <div class="progreess">
                                    <div class="col-md-9">
                                      <div class="progress progress-striped active progress-sm">
                                          <div class="progress-bar progress-bar-success" role="progressbar"
                                               aria-valuenow="{{progress}}" aria-valuemin="0" aria-valuemax="100" style="width: {{ obj.progress }}%">
                                              <span class="sr-only">{{ progress }}% Complete</span>
                                              <span class="progress-bar-value">{{ progress }}%</span>
                                          </div>
                                      </div>
                                    </div>
                                  </div>
                                {% endwith %}

                            </div>
                            <div class="col-md-6">
                              <div id="org-map" class="tab-pane fade in active">
                                 <div class="map-container-fieldsight">
                                    <div id="map" style="height:260px"></div>
                                    <div class="popop-container"  style="display:none">
                                        <h3 class="popop-head"></h3>
                                        <p class="address-popop"></p>
                                        <p class="contact-popop"></p>
                                        <div class="popop-gallery">

                                        </div>
                                    </div>
                                  </div>
                              </div>
                              <!-- <a class="manage-button" href="{% url 'fieldsight:site-blue-prints' obj.pk %}">{% trans 'Add BluePrints' %}</a>
                              <a href="{% url 'forms:setup-site-stages' obj.pk %}" class="manage-button">{% trans 'Stages' %}</a>
                              <a href="{% url 'forms:site-survey' obj.pk %}" class="manage-button">{% trans 'Survey' %}</a>
                              <a href="{% url 'fieldsight:add_supervisor' obj.pk %}" class="manage-button">{% trans 'Assign People' %}</a>
                              <a href="{% url 'forms:site-responses' obj.pk %}" class="manage-button">{% trans 'Responses' %}</a> -->
                            </div>  
                        </div>
                    </div>
                    
                    <div class="clearfixx"></div>
                </div>

        </div>
        <div class="organization-long-detail">
        	<!-- <div class="col-md-6">
                <ul class="nav nav-tabs">
                  <li class="active"><a data-toggle="tab" href="#org-map">Map View</a></li>
                  <li><a data-toggle="tab" href="#org-people">People Involved</a></li>
                  <li><a data-toggle="tab" href="#org-about">About Site</a></li>
                  <li><a data-toggle="tab" href="#org-blueprint">Blueprint</a></li>
                </ul>

                <div class="tab-content">
                  <div id="org-map" class="tab-pane fade in active">
                     <div class="map-container-fieldsight">
                        <div id="map"></div>
                        <div class="popop-container">
                            <h3 class="popop-head"></h3>
                            <p class="address-popop"></p>
                            <p class="contact-popop">01-1234567</p>
                            <div class="popop-gallery">

                            </div>
                        </div>
                      </div>
                  </div>
                  
                  
                  <div id="org-people" class="tab-pane fade">

                     <div class="org-site-list">

                        {% for role in peoples_involved %}

                        <a href="{% url 'users:profile' role.user.id %}">
                            <div class="org-site">
                                
                                <div class="col-md-10">
                                      <div class="detail-org">
                                    <h3 class="pople-Name-org">{{role.user.get_full_name}}</h3>
                                    <p class="address"><span><i class="fa fa-user" aria-hidden="true"></i>
                                    </span>{{ role.user.username }}</p>
                                    <p class="address"><span><i class="fa fa-envelope" aria-hidden="true">

                                    </i></span>{{ role.user.email }}</p>
                                    <p class="address"><span><i class="fa fa-phone" aria-hidden="true"></i>
                                        </span>{{ role.user.user_profile.phone }}</p>

                                    <p class="contact"><span><i class="fa fa-minus" aria-hidden="true"></i></span>
                                    {{ role.group }}
                                    </p>
                                </div>
                                </div>
                                <div class="clearfixx"></div>
                            </div>
                        </a>
                        {% endfor %}
                     </div>
                  </div>
                  <div id="org-about" class="tab-pane fade">
                     <div class="about-organization">
                      <p>{{obj.public_desc}}</p>
                     </div>
                  </div>
                  <div id="org-blueprint" class="tab-pane fade">
                     <div class="about-organization-blueprint">
                      {% for image in obj.blueprints.all %}
                         <div class="org-logo">
                            <img src="{{ image.image.url }}" />
                        </div>
                         {% endfor %}
                     </div>
                  </div>
                </div>    
          </div> -->
            <div class="col-md-12">
                <div class="outstanding-and-all">
                    <ul class="nav nav-tabs">
                      <!-- <li class="all active"><a data-toggle="tab" href="#out-all">All ({{all|length}})</a></li> -->
                      <li class="out active"><a data-toggle="tab" href="#out-standing">Outstanding ({{outstanding|length}})</a></li>
                        <li class="reg"><a data-toggle="tab" href="#out-rejected">Rejected ({{rejected|length}})</a></li>
                        <li class="flag"><a data-toggle="tab" href="#out-flagged">Flagged ({{flagged|length}})</a></li>

                        <ul class="nav navbar-nav navbar-right">
                         <li class="responses-all"><a href="{% url 'forms:site-responses' obj.pk %}">{% trans 'Responses' %}</a></li>
                         <li class="dropdown man-drop">
                          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Manage <span class="caret"></span></a>
                            <ul class="dropdown-menu">
                              <li><a href="{% url 'forms:setup-forms' 0 obj.pk %}">{% trans 'Forms' %}</a></li>
                              <li><a href="{% url 'fieldsight:manage-people-site' obj.pk %}">{% trans 'People' %}</a></li>
                                <li><a href="{% url 'fieldsight:site-blue-prints' obj.pk %}">{% trans 'Add BluePrints' %}</a></li>
                            </ul>
                        </li>  
                       </ul>

                    </ul>

                    <div class="tab-content">
                      <div id="out-standing" class="tab-pane fade in active">
                        <div class="org-site-list">
                            <div class="form-list">
                                <div class="panel panel-default">
                                  <table class="table table-striped table-hover">
                                      {% for instance in outstanding %}
                                      <tr>
                                          <td>
                                              <a title="view submission detail" href="{% url 'forms:instance' instance.site_fxf.pk %}#/{{ instance.instance.id|stringformat:'d'}}">
                                                <h4 class="address">{{ instance.site_fxf.xf.title}}</h4>
                                              </a>
                                          </td>
                                          <td>
                                              <a href="{% url 'users:profile' instance.submitted_by.id %}" title="view details of user">
                                            <div class="detail-person-time">
                                                <span class="site_icon_float"><span class="site_list_icon"><i class="fa fa-user fa-fw"></i></span>{{ instance.submitted_by }}</span>
                                            </div>
                                              </a>
                                          </td>
                                          <td>
                                            <div class="detail-person-time">
                                                <span class="site_icon_float"><span class="site_list_icon"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i></span>{{ instance.date|timesince }}{% trans ' ago' %}</span>
                                            </div>
                                          </td>
                                      </tr>
                                      {% endfor %}
                                  </table>
                                 </div>

                            </div>
                        </div>
                      </div>

                    <div id="out-rejected" class="tab-pane fade in">
                        <div class="org-site-list">
                            <div class="form-list">
                                <div class="panel panel-default">
                                  <table class="table table-striped table-hover">
                                      {% for instance in rejected %}
                                      <tr>
                                          <td>
                                              <a title="view submission detail" href="{% url 'forms:instance' instance.site_fxf.pk %}#/{{ instance.instance.id|stringformat:'d'}}">
                                                <h4 class="address">{{ instance.site_fxf.xf.title}}</h4>
                                              </a>
                                          </td>
                                          <td>
                                              <a href="{% url 'users:profile' instance.submitted_by.id %}" title="view details of user">
                                            <div class="detail-person-time">
                                                <span class="site_icon_float"><span class="site_list_icon"><i class="fa fa-user fa-fw"></i></span>{{ instance.submitted_by }}</span>
                                            </div>
                                              </a>
                                          </td>
                                          <td>
                                            <div class="detail-person-time">
                                                <span class="site_icon_float"><span class="site_list_icon"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i></span>{{ instance.date|timesince }}{% trans ' ago' %}</span>
                                            </div>
                                          </td>
                                      </tr>
                                      {% endfor %}
                                  </table>
                                 </div>

                            </div>
                        </div>
                      </div>

                    <div id="out-flagged" class="tab-pane fade in">
                        <div class="org-site-list">
                            <div class="form-list">
                                <div class="panel panel-default">
                                  <table class="table table-striped table-hover">
                                      {% for instance in flagged %}
                                      <tr>
                                          <td>
                                              <a title="view submission detail" href="{% url 'forms:instance' instance.site_fxf.pk %}#/{{ instance.instance.id|stringformat:'d'}}">
                                                <h4 class="address">{{ instance.site_fxf.xf.title}}</h4>
                                              </a>
                                          </td>
                                          <td>
                                              <a href="{% url 'users:profile' instance.submitted_by.id %}" title="view details of user">
                                            <div class="detail-person-time">
                                                <span class="site_icon_float"><span class="site_list_icon"><i class="fa fa-user fa-fw"></i></span>{{ instance.submitted_by }}</span>
                                            </div>
                                              </a>
                                          </td>
                                          <td>
                                            <div class="detail-person-time">
                                                <span class="site_icon_float"><span class="site_list_icon"><i class="fa fa-clock-o fa-fw" aria-hidden="true"></i></span>{{ instance.date|timesince }}{% trans ' ago' %}</span>
                                            </div>
                                          </td>
                                      </tr>
                                      {% endfor %}
                                  </table>
                                 </div>

                            </div>
                        </div>
                      </div>

                    </div>
                </div>  
            </div>
        </div>



    </div>

{% endblock %}


{% block all_diagrams %} 
    <section class="panel bar-gauge-diagrams">
         <div class="col-md-12">
          <div class="daily-visit">

              <div id="submission-chart" style="width:100%; display: block">

              </div>
              <h4 class="widget-h">{% trans 'Form Submissions' %}</h4>

          </div>
            <hr>
        </div>
        <!--<div class="col-md-12">-->
         <!--<div class="top-stats-panel">-->

             <!--<div id="progress-bar">-->

             <!--</div>-->
             <!--<h4 class="widget-h">Site Progress</h4>-->
             <!--<hr>-->

          <!--</div> -->
        <!--</div>-->

        <div class="clearfixx"></div>
        <div class="flags-dash text-center">
          <div class="col-md-3">
            <div class="out-dash-flag">
              <p class="length-flags-forms">{{outstanding|length}}</p>
              <p class="flags-forms">{% trans 'Outstanding Submissions' %}</p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="flag-dash-flag">
              <p class="length-flags-forms">{{flagged|length}}</p>
              <p class="flags-forms">{% trans 'Flagged Submissions' %}</p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="reg-dash-flag">
              <p class="length-flags-forms">{{rejected|length}}</p>
              <p class="flags-forms">{% trans 'Rejected Submissions' %}</p>
            </div>
          </div>
          <div class="col-md-3">
            <div class="app-dash-flag">
              <p class="length-flags-forms">{{approved|length}}</p>
              <p class="flags-forms">{% trans 'Approved Submissions' %}</p>
            </div>
          </div>
          <div class="clearfixx"></div>
        </div>
    </section>             
  {% endblock %} 
    {%block extrascript %}
    <script type="text/javascript" src="{{ STATIC_URL }}js/map/leaflet.js"></script>

    <script type="text/javascript" src="{{ STATIC_URL }}js/map/leaflet.ajax.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/map/textLabel.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/map/leaflet.markercluster-src.js"></script>

    <script src="http://maps.google.com/maps/api/js?v=3&key=AIzaSyC8uXN1u5FYIaGOUnVK90Rh3wR2Gmyw1uU"></script>
  <script type="text/javascript">
     var static_url ="{{ STATIC_URL }}";
    var data = {{ data|safe}};
    <!--var dict_bar_data = {{ bar_data|safe}};-->
    var line_chart_data = {{ line_chart_data|safe}};

    </script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/map.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/fieldsight/d3.tip.v0.6.3.js"></script>
    <!--<script type="text/javascript" src="{{ STATIC_URL }}js/fieldsight/project_dashboard_bar-graph.js"></script>-->
    <script type="text/javascript" src="{{ STATIC_URL }}js/fieldsight/project_dashboard_line_chart.js"></script>
{% endblock %}