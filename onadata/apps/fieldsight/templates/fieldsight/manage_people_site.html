{% extends "fieldsight/fieldsight_base.html" %}
{% load i18n staticfiles %}
{% load filters %}
{% block kocript %}
<link rel="stylesheet" href="{% static 'css/toastr.css' %}">
<script type="text/javascript" src="{{ STATIC_URL }}js/fieldsight/plugin/toastr.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.blockUI.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/fieldsight/App.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/fieldsight/manage_people_site.js"></script>

<script>
var proj_site_url = "";
var userurl = "";
var speed=0;
var selected_users=[];
var all_users=[];
var selected_proj_site=[];
var all_proj_site=[];
var CSRF_TOKEN = '{{ csrf_token }}';

{% if type == "project" %}
  {% if obj.cluster_sites %}
  var proj_region_url = '{% url 'fieldsight:project_regions_list' pk %}';
  assignurl = '{% url 'fieldsight:multi_user_region_assign' pk %}';
  var type = "region";
  {% else %}
  var proj_site_url = '{% url 'role:multi_ops_list' 0 pk %}';
  assignurl = '{% url 'fieldsight:multi_user_site_assign' pk %}';
  var type = "site";
  {% endif %}
  userurl = '{% url 'role:multi_user_list' 1 pk %}';
  

{% elif type == "org" %}
  
  var proj_site_url = '{% url 'role:multi_ops_list' 1 pk %}';
  userurl = '{% url 'role:multi_user_list' 1 pk %}';
  assignurl = '{% url 'fieldsight:multi_user_project_assign' pk %}'

{% endif %}

$(document).ready(function() {
var pk = "{{pk}}";
var level = "{{level}}";
var organization = "{{organization}}";
var csrf_token = "{{csrf_token}}";

assigntoken(csrf_token);
vm = new ManagePeopleViewModel(pk, level, organization);
 ko.applyBindings(vm);
});

</script>
{% endblock %}
{% block content %}
{% csrf_token %}
<input type="hidden" id="invite_organization_id" value="{{ organization }}">
<input type="hidden" id="invite_project_id" value="{{ project }}">
<input type="hidden" id="invite_site_id" value="{{ site }}">
<!-- {% if category == "site" %}
<input type="radio" name="group" id="invite_group" value="Reviewer" checked> Reviewer<br>
<input type="radio" name="group" id="invite_group" value="Site Supervisor"> Site Supervisor<br>
{% else %}
<input type="hidden" id="invite_group" value="{{ category }}">
{% endif %} -->


			<div id="main-content" class="padding">
              {% block breadcrumbs %}
              <ul class="breadcrumbb">
                {% if level == "0" %}
                <li><a href="{% url 'fieldsight:site-dashboard' pk %}">
                 {% trans 'Site Dashboard' %}</a></li>
                {% endif %}
                {% if level == "1" %}
                <li><a href="{% url 'fieldsight:project-dashboard' pk %}">
                 {% trans 'Project Dashboard' %}</a></li>
                {% endif %}
                {% if level == "2" %}
                <li><a href="{% url 'fieldsight:organizations-dashboard' pk %}">
                 {% trans 'Organization Dashboard' %}</a></li>
                {% endif %}
                <li>{% trans 'Manage People' %}</li>
              </ul>
              {% endblock %}
				<div class="row" data-bind="with:siteVm ,visible: currentVm() == 'site'" style="display:none;">




          <div class="tabbing margin-top">
          <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item">
              <a class="nav-link active" data-toggle="tab" href="#tab001" role="tab">Assign Site Supervisors</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-toggle="tab" href="#tab002" role="tab">Assign Site Reviewers</a>
            </li>
          </ul>
          <!-- Tab panes -->
          <div class="tab-content">
            <div class="tab-pane active" id="tab001" role="tabpanel">
              <ul class="row">
                 

                      <div class="col-md-4">
            <div class="widget-info margin-top bg-white padding">
              <div class="widget-head">
                <h4>Current Supervisors</h4>
              </div>

              <div class="widget-body max-513-scolling" data-bind="foreach:allSupervisors">
                <div class="project-item-wrap clearfix">
                  <div class="project-logo">
                    <img data-bind="attr:{src: user().profile_picture}" alt="" width="50" height="50">
                  </div>
                  <div class="project-basic-info">
                    <h4 data-bind="text:user().full_name"></h4>
                    <p data-bind="text:user().email"></p>
                  </div>
                  <a href="#" title="" class="btn btn-danger btn-sm project-action" data-bind="confirmClick: { message: 'Are you sure to remove this supervisor?', click:rmrole }"><i class="la la-close"></i></a>
                  </div>
                  </div>
                  </div>
                  </div>
            <div class="col-md-8">
            <div class="widget-info margin-top bg-white padding">
              <div class="widget-head">
                <h4>Invite new Supervisors</h4>
              </div>
              <div class="widget-body">
                <form>
                  <div class="input-group">
                    <input type="text" id="invite_email" name="email" class="form-control" placeholder="Enter email to invite .." aria-label="Invite to...">
                    <span class="input-group-btn">
                      <button class="btn btn-primary" id="retry" onclick="sendmultiplerequest('Site Supervisor')" type="button"><i class="la la-user-plus"></i> Invite</button>
                    </span>
                  </div>
                </form>


               
                <h4 class="text-center margin-top">
                <strong>OR</strong>
                </h4>
                <div class="widget-head">
                <h4>Select users to assign as supervisor</h4>
                </div>
                <form class="margin-top">
                  <div class="input-group">
                    <input type="text" class="form-control" data-bind="value:$root.search_key, valueUpdate:'afterkeydown'" placeholder="Search..." aria-label="Search...">
                  </div>
                </form>
                 <input type="button" value="Select All" class="btn btn-primary margin-top" data-bind=" click:$root.setAllAssignAsSelected">
                 <input type="button" value="Unselect All" class="btn btn-primary margin-top" data-bind="click:$root.setAllUnSelected">
                  <button type="submit" class="btn btn-primary margin-top" data-bind="click:$root.assignsupervisors"><i class="la la-user-plus"></i> Assign selected as Supervisors</button>
               
                <ul class="row" data-bind="foreach:$root.users">
                  <li class="col-md-4">
                    <label class="custom-control margin-top user-checkbox custom-checkbox" >
                      <input type="checkbox" class="custom-control-input" data-bind="checked: selected, click:$root.setSelected">
                      <span class="custom-control-indicator"></span>
                      <span class="custom-control-description">
                        <div class="project-item-wrap clearfix">
                          <div class="project-logo">
                            <img data-bind="attr:{src: user().profile_picture}" alt="" width="50" height="50">
                          </div>
                          <div class="project-basic-info">
                            <h4 data-bind="text:user().full_name"></h4>
                            <p data-bind="text:user().email"></p>
                          </div>
                        </div>
                       <!--  <a href="#" title="" class="btn btn-xs btn-block btn-primary">Details</a> -->
                      </span>
                    </label>
                  </li>
                  
                  <li class="clearfix"></li>
                </ul>
                <div class="margin-top">
               
                </div>

              </div>
            </div>
          </div>




                  <li class="clearfix"></li>
                </ul>
            </div>
            
            <div class="tab-pane" id="tab002" role="tabpanel">



            <ul class="row">
                 

                      <div class="col-md-4">
            <div class="widget-info margin-top bg-white padding">
              <div class="widget-head">
                <h4>Current Reviewers</h4>
              </div>

              <div class="widget-body max-513-scolling" data-bind="foreach:allReviewers">
                <div class="project-item-wrap clearfix">
                  <div class="project-logo">
                    <img data-bind="attr:{src: user().profile_picture}" alt="" width="50" height="50">
                  </div>
                  <div class="project-basic-info">
                    <h4 data-bind="text:user().full_name"></h4>
                    <p data-bind="text:user().email"></p>
                  </div>
                  <a href="#" title="" class="btn btn-danger btn-sm project-action" data-bind="confirmClick: { message: 'Are you sure to remove this reviewer?', click:rmrole }"><i class="la la-close"></i></a>
                  </div>
                  </div>
                  </div>
                  </div>


          <div class="col-md-8">
            <div class="widget-info margin-top bg-white padding">
              <div class="widget-head">
                <h4>Invite New Reviewers</h4>
              </div>
              <div class="widget-body">
                <form>
                  <div class="input-group">
                    <input type="text" id="invite_email" name="email" class="form-control" placeholder="Enter email to invite .." aria-label="Invite to...">
                    <span class="input-group-btn">
                      <button class="btn btn-primary" id="retry" onclick="sendmultiplerequest('Reviewer')" type="button"><i class="la la-user-plus"></i> Invite</button>
                    </span>
                  </div>
                </form>


               
                <h4 class="text-center margin-top">
                <strong>OR</strong>
                </h4>
                <div class="widget-head">
                <h4>Select users to assign as reviewer</h4>
                </div>
                <form class="margin-top">
                  <div class="input-group">
                    <input type="text" class="form-control" data-bind="value:$root.search_key, valueUpdate:'afterkeydown'" placeholder="Search..." aria-label="Search...">
                  </div>
                </form>
                 <input type="button" value="Select All" class="btn btn-primary margin-top" data-bind=" click:$root.setAllAssignAsSelected">
                 <input type="button" value="Unselect All" class="btn btn-primary margin-top" data-bind="click:$root.setAllUnSelected">
                <button type="submit" class="btn btn-primary margin-top" data-bind="click:$root.assignreviewers"><i class="la la-user-plus"></i> Assign seleeted as Reviewers</button>
                <ul class="row" data-bind="foreach:$root.users">
                  <li class="col-md-4">
                    <label class="custom-control margin-top user-checkbox custom-checkbox" >
                      <input type="checkbox" class="custom-control-input" data-bind="checked: selected, click:$root.setSelected">
                      <span class="custom-control-indicator"></span>
                      <span class="custom-control-description">
                        <div class="project-item-wrap clearfix">
                          <div class="project-logo">
                            <img data-bind="attr:{src: user().profile_picture}" alt="" width="50" height="50">
                          </div>
                          <div class="project-basic-info">
                            <h4 data-bind="text:user().full_name"></h4>
                            <p data-bind="text:user().email"></p>
                          </div>
                        </div>
                        <!-- <a href="#" title="" class="btn btn-xs btn-block btn-primary">Details</a> -->
                      </span>
                    </label>
                  </li>
                  
                  <li class="clearfix"></li>
                </ul>
                <div class="margin-top">
                
             
                </div>

              </div>
            </div>
          </div>




                  <li class="clearfix"></li>
                </ul>





            </div>
          </div>
         <!--  <button type="submit" class="btn btn-primary btn-block"><i class="la la-user-plus"></i> Assign Users</button> -->
        </div>






			</div>



      <!-- for project -->

      <div class="row" data-bind="with:projectVm ,visible: currentVm() == 'project'" style="display:none;">



      <div class="tabbing margin-top">
          <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item">
              <a class="nav-link active" data-toggle="tab" href="#tab001" role="tab">Assign Project Managers</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-toggle="tab" href="#tab002" role="tab">Assign Site Users</a>
            </li>
          </ul>
          <!-- Tab panes -->
          <div class="tab-content">
            <div class="tab-pane active" id="tab001" role="tabpanel">
              <ul class="row">
                 


                  <div class="col-md-8">
            <div class="widget-info margin-top bg-white padding">
              <div class="widget-head">
                <h4>Invite new project managers</h4>
              </div>
              <div class="widget-body">
                <form>
                  <div class="input-group">
                    <input type="text" id="invite_email" name="email" class="form-control" placeholder="Enter email to invite .." aria-label="Invite to...">
                    <span class="input-group-btn">
                      <button class="btn btn-primary" id="retry" onclick="sendmultiplerequest('Project Manager')" type="button"><i class="la la-user-plus"></i> Invite</button>
                    </span>
                  </div>
                </form>


               
                <h4 class="text-center margin-top">
                <strong>OR</strong>
                </h4>
                <div class="widget-head">
                <h4>Select Users to assign as Project Managers</h4>
                </div>
               
                <form class="margin-top">
                  <div class="input-group">
                    <input type="text" class="form-control" data-bind="value:$root.search_key, valueUpdate:'afterkeydown'" placeholder="Search..." aria-label="Search...">
                  </div>
                </form>
                 <input type="button" value="Select All" class="btn btn-primary margin-top" data-bind=" click:$root.setAllAssignAsSelected">
                 <input type="button" class="btn btn-primary margin-top" value="Unselect All" data-bind="click:$root.setAllUnSelected">

                <button type="submit" class="btn btn-primary margin-top" data-bind="click:$root.assignPM"><i class="la la-user-plus"></i> Assign selected as Project Manager</button>
               
                <ul class="row" data-bind="foreach:$root.users">
                  <li class="col-md-4">
                    <label class="custom-control margin-top user-checkbox custom-checkbox" >
                      <input type="checkbox" class="custom-control-input" data-bind="checked: selected, click:$root.setSelected">
                      <span class="custom-control-indicator"></span>
                      <span class="custom-control-description">
                        <div class="project-item-wrap clearfix">
                          <div class="project-logo">
                            <img data-bind="attr:{src: user().profile_picture}" alt="" width="50" height="50">
                          </div>
                          <div class="project-basic-info">
                            <h4 data-bind="text:user().full_name"></h4>
                            <p data-bind="text:user().email"></p>
                          </div>
                        </div>
                        <!-- <a href="#" title="" class="btn btn-xs btn-block btn-primary">Details</a> -->
                      </span>
                    </label>
                  </li>
                  
                  <li class="clearfix"></li>
                </ul>
                <div class="margin-top">
                </div>

              </div>
            </div>
          </div>

          <div class="col-md-4">
            <div class="widget-info margin-top bg-white padding">
              <div class="widget-head">
                <h4>Current Project Managers</h4>
              </div>

              <div class="widget-body max-513-scolling" data-bind="foreach:projectManagers">
                <div class="project-item-wrap clearfix">
                  <div class="project-logo">
                    <img data-bind="attr:{src: user().profile_picture}" alt="" width="50" height="50">
                  </div>
                  <div class="project-basic-info">
                    <h4 data-bind="text:user().full_name"></h4>
                    <p data-bind="text:user().email"></p>
                  </div>
                  <a href="#" title="" class="btn btn-danger btn-sm project-action" data-bind="confirmClick: { message: 'Are you sure to remove this Project Manager?', click:rmrole }"><i class="la la-close"></i></a>



                  <li class="clearfix"></li>
                </ul>
            </div>
            <div class="tab-pane" id="tab002" role="tabpanel">
              <ul class="row">
                  

                      <div class="row">
          <div class="col-md-6">
            <div class="widget-info margin-top bg-white padding">
              <div class="widget-head">
                <h4>Invite new users</h4>
              </div>

              <div class="widget-body">

                <!-- <ul class="row max-260-scroll" id="multi-ass-users">
                <input type="button" value="Select All" onclick="selectall('users')">
                 <input type="button" value="Unselect All" onclick="unselectall('users')">


                  
                
                 
                </ul> -->
                 <div class="input-group">
                    <input type="text" id="multi_invite_email_ps" name="email" class="form-control" placeholder="Enter email to invite .." aria-label="Invite to...">
                    <span class="input-group-btn">
                      
                      <span class="dropdown">
                    <a href="#" id="dropdownMenuButtonManage" class="btn btn-primary margin-top" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                      <i class="la la-cogs"></i>Invite
                    </a>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButtonManage" x-placement="bottom-end" style="background-color: #00628E; position: absolute; transform: translate3d(74px, 24px, 0px); top: 0px; left: 0px; will-change: transform;">
                      <a class="dropdown-item" href="#" style="color:white;" data-bind="click:invitesupervisors"><i class="la la-user"></i>As Site Supervisor</a>
                      <a class="dropdown-item" href="#" style="color:white;" data-bind="click:invitereviewers"><i class="la la-clipboard"></i>As Reviewer</a>
                      


                     
                    </div>
                  </span>



                     
                    </span>
                  </div>
                  <br>
                  <h4 class="text-center margin-top">
                <strong>OR</strong>
                </h4>
                <div class="widget-head">
                <h4>
                    {% if obj.cluster_sites %}
                Select Users to assign to all sites in regions.
                  {% else %}
                Select Users to assign to sites                  
                  {% endif %}
                </h4>
                </div>
                  <input type="text" class="form-control" data-bind="value:$root.search_key, valueUpdate:'afterkeydown'" placeholder="Search..." aria-label="Search...">
                  <input type="button" value="Select All" class="btn btn-primary margin-top" data-bind=" click:$root.setAllAssignAsSelected">
                 <input type="button" value="Unselect All" class="btn btn-primary margin-top" data-bind="click:$root.setAllUnSelected">
                 <span class="dropdown">
                            <a href="#" id="dropdownMenuButtonManage" class="btn btn-primary margin-top" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                              <i class="la la-cogs"></i>Invite Selected Users
                            </a>
                            <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenuButtonManage" x-placement="bottom-end" style="background-color: #00628E; position: absolute; transform: translate3d(74px, 24px, 0px); top: 0px; left: 0px; will-change: transform;">
                              <a class="dropdown-item" href="#" style="color:white;" data-bind="click:assignselectedsupervisor"><i class="la la-user"></i>As Site Supervisor</a>
                              <a class="dropdown-item" href="#" style="color:white;" data-bind="click:assignselectedreviewer"><i class="la la-clipboard"></i>As Reviewer</a>
                              
                            </div>
                          </span>
                <ul class="row" data-bind="foreach:$root.users">
                  <li class="col-md-12">
                    <label class="custom-control margin-top user-checkbox custom-checkbox" >
                      <input type="checkbox" class="custom-control-input" data-bind="checked: selected, click:$root.setSelected">
                      <span class="custom-control-indicator"></span>
                      <span class="custom-control-description">
                        <div class="project-item-wrap clearfix">
                          <div class="project-logo">
                            <img data-bind="attr:{src: user().profile_picture}" alt="" width="50" height="50">
                          </div>
                          <div class="project-basic-info">
                            <h4 data-bind="text:user().full_name"></h4>
                            <p data-bind="text:user().email"></p>
                          </div>
                        </div>
                       
                      </span>
                    </label>
                  </li>
                  
                  <li class="clearfix"></li>
                </ul>
                <input style="display:none;" type="button" id="getnextlist" onclick="" value="load more">
                <input type="radio" style="display:none;" name="group" id="group" value="Project Manager" checked>
              </div>
            </div>
          </div>



          <div class="col-md-6">
            <div class="widget-info margin-top bg-white padding">
              <div class="widget-head">
                <h4>
                  {% if obj.cluster_sites %}
                Select Regions
                  {% else %}
                Select Sites 
                  {% endif %}
                </h4>

              </div>
              <div class="widget-body">
                <!-- <ul class="row max-260-scroll" id="multi-ass-proj_site">
                  <input type="button" value="Select All" onclick="selectall('proj_site')">
                 <input type="button" value="Unselect All" onclick="unselectall('proj_site')">

                </ul>
                <input style="display:none;" type="button" id="getnextproj_site_list" onclick="" value="load more"> -->
                <input type="text" class="form-control" data-bind="value:search_key, valueUpdate:'afterkeydown'" placeholder="Search..." aria-label="Search...">
                  <input type="button" value="Select All" class="btn btn-primary margin-top" data-bind=" click:setAllAssignAsSelected">
                 <input type="button" value="Unselect All" class="btn btn-primary margin-top" data-bind="click:setAllUnSelected">
              {% if obj.cluster_sites %}

                <ul class="row" data-bind="foreach:regions">
                
                  <li class="col-md-12">
                    <label class="custom-control margin-top user-checkbox custom-checkbox" >
                      <input type="checkbox" class="custom-control-input" data-bind="checked: selected, click:$parent.setSelected">
                      <span class="custom-control-indicator"></span>
                      <span class="custom-control-description">
                        <div class="project-item-wrap clearfix">
                          <div class="project-logo">
                            <!-- <img data-bind="attr:{src: logo()}" alt="" width="50" height="50"> -->
                          </div>
                          <div class="project-basic-info">
                            <h4 data-bind="text:name()"></h4>
                          </div>
                        </div>
                       
                      </span>
                    </label>
                  </li>
                  
                  <li class="clearfix"></li>
                </ul>              

              {% else %}

                <ul class="row" data-bind="foreach:sites">
                
                  <li class="col-md-12">
                    <label class="custom-control margin-top user-checkbox custom-checkbox" >
                      <input type="checkbox" class="custom-control-input" data-bind="checked: selected, click:$parent.setSelected">
                      <span class="custom-control-indicator"></span>
                      <span class="custom-control-description">
                        <div class="project-item-wrap clearfix">
                          <div class="project-logo">
                            <img data-bind="attr:{src: logo()}" alt="" width="50" height="50">
                          </div>
                          <div class="project-basic-info">
                            <h4 data-bind="text:name()"></h4>
                            <p data-bind="text:email()"></p>
                          </div>
                        </div>
                       
                      </span>
                    </label>
                  </li>
                  
                  <li class="clearfix"></li>
                </ul>
              {% endif %}
              </div>
            </div>
          </div>


          
        </div>


                  <li class="clearfix"></li>
                </ul>
            </div>
          </div>
         <!--  <button type="submit" class="btn btn-primary btn-block"><i class="la la-user-plus"></i> Assign Users</button> -->
        </div>



          



          <span class="closebtn-cu"><i class="fa fa-times" aria-hidden="true"></i></span>
        </div>


 <!-- for project -->

      <div class="row" data-bind="with:orgVm, visible: currentVm() == 'organization'" style="display:none;">



      <div class="tabbing margin-top">
          <ul class="nav nav-tabs" role="tablist">
            <li class="nav-item">
              <a class="nav-link active" data-toggle="tab" href="#tab001" role="tab">Assign Organization Admins</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" data-toggle="tab" href="#tab002" role="tab">Assign Project Managers</a>
            </li>
          </ul>
          <!-- Tab panes -->
          <div class="tab-content">
            <div class="tab-pane active" id="tab001" role="tabpanel">
              <ul class="row">
                 


                  <div class="col-md-8">
            <div class="widget-info margin-top bg-white padding">
              <div class="widget-head">
                <h4>Invite new organization admins</h4>
              </div>
              <div class="widget-body">
                <form>
                  <div class="input-group">
                    <input type="text" id="invite_email" name="email" class="form-control" placeholder="Enter email to invite .." aria-label="Invite to...">
                    <span class="input-group-btn">
                      <button class="btn btn-primary" id="retry" onclick="sendmultiplerequest('Organization Admin')" type="button"><i class="la la-user-plus"></i> Invite</button>
                    </span>
                  </div>
                </form>


               
                <h4 class="text-center margin-top">
                <strong>OR</strong>
                </h4>
                 <div class="widget-head">
                <h4>Select users to assign as organization admin</h4>
              </div>
                <form class="margin-top">
                  <div class="input-group">
                    <input type="text" class="form-control" data-bind="value:$root.search_key, valueUpdate:'afterkeydown'" placeholder="Search..." aria-label="Search...">
                  </div>
                </form>
                 <input type="button" class="btn btn-primary margin-top" value="Select All" data-bind=" click:$root.setAllAssignAsSelected">
                 <input type="button" class="btn btn-primary margin-top" value="Unselect All" data-bind="click:$root.setAllUnSelected">

                  <button type="submit" class="btn btn-primary margin-top" data-bind="click:$root.assignOadmin"><i class="la la-user-plus"></i> Assign Organization Admin</button>
                <ul class="row" data-bind="foreach:$root.users">
                  <li class="col-md-4">
                    <label class="custom-control margin-top user-checkbox custom-checkbox" >
                      <input type="checkbox" class="custom-control-input" data-bind="checked: selected, click:$root.setSelected">
                      <span class="custom-control-indicator"></span>
                      <span class="custom-control-description">
                        <div class="project-item-wrap clearfix">
                          <div class="project-logo">
                            <img data-bind="attr:{src: user().profile_picture}" alt="" width="50" height="50">
                          </div>
                          <div class="project-basic-info">
                            <h4 data-bind="text:user().full_name"></h4>
                            <p data-bind="text:user().email"></p>
                          </div>
                        </div>
                       <!--  <a href="#" title="" class="btn btn-xs btn-block btn-primary">Details</a> -->
                      </span>
                    </label>
                  </li>
                  
                  <li class="clearfix"></li>
                </ul>
                <div class="margin-top">
                
               
                </div>

              </div>
            </div>
          </div>

          <div class="col-md-4">
            <div class="widget-info margin-top bg-white padding">
              <div class="widget-head">
                <h4>Current Organization Admins</h4>
              </div>

              <div class="widget-body max-513-scolling" data-bind="foreach:admins">
                <div class="project-item-wrap clearfix">
                  <div class="project-logo">
                    <img data-bind="attr:{src: user().profile_picture}" alt="" width="50" height="50">
                  </div>
                  <div class="project-basic-info">
                    <h4 data-bind="text:user().full_name"></h4>
                    <p data-bind="text:user().email"></p>
                  </div>
                  <a href="#" title="" class="btn btn-danger btn-sm project-action" data-bind="confirmClick: { message: 'Are you sure to remove this Organization Admin?', click:rmrole }"><i class="la la-close"></i></a>



                  <li class="clearfix"></li>
                </ul>
            </div>
            <div class="tab-pane" id="tab002" role="tabpanel">
              <ul class="row">
                  

                      <div class="row">
          <div class="col-md-6">
            <div class="widget-info margin-top bg-white padding">
              <div class="widget-head">
                <h4>Invite new project managers</h4>
              </div>
              <div class="widget-body">

                <!-- <ul class="row max-260-scroll" id="multi-ass-users">
                <input type="button" value="Select All" onclick="selectall('users')">
                 <input type="button" value="Unselect All" onclick="unselectall('users')">


                  
                
                 
                </ul> -->
                 <div class="input-group">
                    <input type="text" id="multi_invite_email_ps" name="email" class="form-control" placeholder="Enter email to invite .." aria-label="Invite to...">
                    <span class="input-group-btn">
                      <button class="btn btn-primary" id="retry" data-bind="click:inviteforemails" type="button"><i class="la la-user-plus"></i> Invite</button>
                    </span>
                  </div>
                  <br>
                 <h4 class="text-center margin-top">
                <strong>OR</strong>
                </h4>
                  <div class="widget-head">
                <h4>Select users to assign to projects</h4>
              </div>
                  <input type="text" class="form-control" data-bind="value:$root.search_key, valueUpdate:'afterkeydown'" placeholder="Search..." aria-label="Search...">
                  <input type="button" value="Select All" class="btn btn-primary margin-top"  data-bind=" click:$root.setAllAssignAsSelected">
                 <input type="button" value="Unselect All" class="btn btn-primary margin-top" data-bind="click:$root.setAllUnSelected">
                <ul class="row" data-bind="foreach:$root.users">
                  <li class="col-md-12">
                    <label class="custom-control margin-top user-checkbox custom-checkbox" >
                      <input type="checkbox" class="custom-control-input" data-bind="checked: selected, click:$root.setSelected">
                      <span class="custom-control-indicator"></span>
                      <span class="custom-control-description">
                        <div class="project-item-wrap clearfix">
                          <div class="project-logo">
                            <img data-bind="attr:{src: user().profile_picture}" alt="" width="50" height="50">
                          </div>
                          <div class="project-basic-info">
                            <h4 data-bind="text:user().full_name"></h4>
                            <p data-bind="text:user().email"></p>
                          </div>
                        </div>
                       
                      </span>
                    </label>
                  </li>
                  
                  <li class="clearfix"></li>
                </ul>
                <input style="display:none;" type="button" id="getnextlist" onclick="" value="load more">
                <input type="radio" style="display:none;" name="group" id="group" value="Project Manager" checked>
              </div>
            </div>
          </div>



          <div class="col-md-6">
            <div class="widget-info margin-top bg-white padding">
              <div class="widget-head">
                <h4>Select Projects</h4>
              </div>
              <div class="widget-body">
                <!-- <ul class="row max-260-scroll" id="multi-ass-proj_site">
                  <input type="button" value="Select All" onclick="selectall('proj_site')">
                 <input type="button" value="Unselect All" onclick="unselectall('proj_site')">

                </ul>
                <input style="display:none;" type="button" id="getnextproj_site_list" onclick="" value="load more"> -->
                <input type="text" class="form-control" data-bind="value:search_key, valueUpdate:'afterkeydown'" placeholder="Search..." aria-label="Search...">
                  <input type="button" value="Select All" class="btn btn-primary margin-top" data-bind="click:setAllAssignAsSelected">
                 <input type="button" value="Unselect All" class="btn btn-primary margin-top" data-bind="click:setAllUnSelected">
                 <button type="submit" class="btn btn-primary margin-top" data-bind="click:doAssign"><i class="la la-user-plus"></i> Assign as Project Managers</button>
  

                <ul class="row" data-bind="foreach:projects">
                
                  <li class="col-md-12">
                    <label class="custom-control margin-top user-checkbox custom-checkbox" >
                     
                       <input type="checkbox" class="custom-control-input" data-bind="checked: selected, click:$parent.setSelected">

                      <span class="custom-control-indicator"></span>
                      <span class="custom-control-description">
                        <div class="project-item-wrap clearfix">
                          <div class="project-logo">
                            <img data-bind="attr:{src: logo()}" alt="" width="50" height="50">
                          </div>
                          <div class="project-basic-info">
                            <h4 data-bind="text:name()"></h4>
                            <p data-bind="text:email()"></p>
                          </div>
                        </div>
                       
                      </span>
                    </label>
                  </li>
                  
                  <li class="clearfix"></li>
                </ul>
                
              </div>
            </div>
          </div>




                  <li class="clearfix"></li>
                </ul>
            </div>
          </div>
         <!--  <button type="submit" class="btn btn-primary btn-block"><i class="la la-user-plus"></i> Assign Users</button> -->
        </div>



          



          <span class="closebtn-cu"><i class="fa fa-times" aria-hidden="true"></i></span>
        </div>
                </div>
                
            </div>
          </div>



    
        <!-- <div class="margin-top">
          <div class="padding bg-white">
            <button type="submit" class="btn btn-primary btn-block"><i class="la la-user-plus"></i> Assign Users</button>
          </div>
        </div> -->
        </div>
        </div><div class="modal fade" id="myinvitemodal" role="dialog" >
                      <div class="modal-dialog">
                      
                        <!-- Modal content-->
                        <div class="modal-content" style="margin-top: 15%;">
                          <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                            <h4 class="modal-title">Invite Status</h4>
                          </div>
                          <div class="modal-body">
                          <center>
                            <div id="update-next-step">
                            <h2>Inviting ...</h2>
                          
                            </div>
                            </center>
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                          </div>
                        </div>
                        
                      </div>
                    </div>

<script>
var ajax_call=false;
var status = true;
// function refresh(group){
//   var email = $("#invite_email").val();
  

//   // if(email.indexOf(',') > -1){

//   //       // alert('ola');
//         sendmultiplerequest(email);

//   //       return false;  
//   // }
//   // else{
//   // data = validateemail(email);
  
//   // if(data.status == false){
//   //   return false;
//   // }

//   // ajax_call = true;
//   // checkemail(email);
//   // }   
// }
function validateemail(email){
  var atherate = email.indexOf("@");
  var dot = email.indexOf(".", atherate);
    
      if(atherate != -1 && dot != -1){
        return {
        status: true,
        email: email
        };
      }
      else{
        // alert("Enter valid email address.");
        return {
        status: false,
        email: email
        };
      }
}
 function getNewInsertion(newValue) {
     if(newValue.indexOf(',') > -1){
        $("#retry").val('Invite Users');  
        }
     else{
       $("#retry").val('Search User');
     }
}


function sendmultiplerequest(group){
    var email = $("#invite_email").val();
    status=true;
    emails = email.split(",");
    emails.forEach(multiemailvalidate);
    if(status == "true" ){ sendinvite(emails, group); }
    else{ alert('failed'); }
}

function multiemailvalidate(entry) {
    email_res = validateemail(entry);
    if(email_res.status == false){
      
      var email_input = document.getElementById("invite_email");
      email = email_input.value;
      start = email.search(email_res.email);
      end = email.indexOf(",", start);
      // console.log(start +" "+ end);
      email_input.setSelectionRange(start, end);
      email_input.focus();
      status=false;


      }
    }

$(function(){

    $("#invite_email").bind("paste cut keydown",function(e) {
        var that = this;
        
        setTimeout(function() {
                
                if(typeof $(that).data("old_value") == "undefined") {
                    $(that).data("old_value",$(that).val());
                }
                
                getNewInsertion($(that).val());

            },200);

    })

}); 


function log(val) {
    console.log(val);
}

  function checkemail(email){
        $.ajax({
        url: "{% url 'fieldsight:check-email-for-invite' %}",
        data: {'email': email, 'csrfmiddlewaretoken': '{{ csrf_token }}'},
        type: 'POST',
        success: function (html) {
           $('#update-next-step').html(html);
           $('#retry').show();
        }
      });
  }

function sendnewuserinvite(){
  emails = [];
  var email = $("#invite_email").val();
  emails.push(email);
  sendinvite(emails);
}
      

  </script>
{% if category == "site" %}

<script>
  function sendinvite(emails, group){
      $('#myinvitemodal').modal(); 
      var organization_id = $("#invite_organization_id").val();
      var project_id = $("#invite_project_id").val();
      var site_id = $("#invite_site_id").val();
      // console.log(emails);
      // console.log(group);
      // console.log(project_id);
      // console.log(site_id);
      // console.log(organization_id);
      $.ajax({
        url: "{% url 'fieldsight:senduserinvite' %}",
        data: {'emails[]': emails, 'organization_id':organization_id,'project_id':project_id,'site_id':site_id,'group':group, 'csrfmiddlewaretoken': '{{ csrf_token }}'},
        type: 'POST',
        success: function (html) {
           $('#update-next-step').html(html);
        }
      });
    }
</script>
{% else %}
<script>
  function sendinvite(emails, group){ 
      $('#myinvitemodal').modal(); 
      var organization_id = $("#invite_organization_id").val();
      var project_id = $("#invite_project_id").val();
      var site_id = $("#invite_site_id").val();
      
      $.ajax({
        url: "{% url 'fieldsight:senduserinvite' %}",
        data: {'emails[]': emails, 'organization_id':organization_id,'project_id':project_id,'site_id':site_id,'group':group, 'csrfmiddlewaretoken': '{{ csrf_token }}'},
        type: 'POST',
        success: function (html) {

           $('#update-next-step').html(html);
            
        }
      });
}
///////////////////// END OF USER INVITE SCRIPT
</script>

{% endif %}


<script type="text/javascript">


///// Multi user assign starts here.
console.log(userurl);



// document.onload = getuserlist(userurl);
// document.onload = getproj_site_url_list(proj_site_url);


// function getuserlist(url){
   
//       $.ajax({
//         url: url,
//         type: 'GET',
//         success: function (data) {
//            data.forEach(populateuserlist);
//            speed=0;
//            if (data.next == null){
//             document.getElementById('getnextlist').style.display = 'none';
//            }else{
//             document.getElementById('getnextlist').style.display = 'block';
//             document.getElementById("getnextlist").setAttribute( "onClick", "javascript: getuserlist('"+ data.next+"');" );
//         }
//         // console.log(data);
//         }
//       });
// }

// function getproj_site_url_list(url){
//       $.ajax({
//         url: url,

//         type: 'GET',
//         success: function (data) {
//            speed_proj_site=0;
//            data.forEach(populate_proj_site_list);
           
//            if (data.next == null){
//             document.getElementById('getnextproj_site_list').style.display = 'none';
//            }else{
//             document.getElementById('getnextproj_site_list').style.display = 'block';
//             document.getElementById("getnextproj_site_list").setAttribute( "onClick", "javascript: getproj_site_url_list('"+ data.next+"');" );
//         }
//         }
//       });
// }

////////////////////////////////--- Populate Lists

function populateuserlist(data, index){

all_users.push(data.user.id);

var user_list = '<li class="col-md-12" id="'+data.user.id+'usersli">'+
                    '<label class="custom-control margin-top user-checkbox custom-checkbox">'+
                      '<input type="checkbox" class="custom-control-input" onclick="checkifuserisselected('+ data.user.id +')">'+
                      '<span class="custom-control-indicator"></span>'+
                      '<span class="custom-control-description">'+
                        '<div class="project-item-wrap clearfix">'+
                          '<div class="project-logo">'+
                            '<img src="'+ data.user.profile_picture +'" alt="" width="50" height="50">'+
                          '</div>'+
                          '<div class="project-basic-info">'+
                            '<h4>' + data.user.first_name +' '+ data.user.last_name+ '</h4>'+
                            '<p>'+ data.user.email +'</p>'+
                          '</div>'+
                        '</div>'+
                        // '<a href="#" title="" class="btn btn-xs btn-block btn-primary">Details</a>'+
                      '</span>'+
                    '</label>'+
                  '</li>';


    // var user_list = '<li class="note-div-sm '+ data.id +'" id="'+data.id+'usersli" style="display:none;" onclick="checkifuserisselected(`'+ data.user.id +'`)"> <div class="col-md-1"><i class="fa fa-info-circle fa-1 note-icon-sm"></i> </div>   <div class="col-md-10"><span class="detail-text1 notification-title-sm">'+ data.user.username +'</span><div class="low">  <i class="fa fa-clock-o space" aria-hidden="true"></i>'+ data.user.email +' </div></div>  </li>';

    // var div = document.getElementById('notifications');

    // div.innerHTML += new_li;
    speed = speed+200;

$(user_list).appendTo("#multi-ass-users");
$("#"+data.id+"usersli").fadeIn(speed);
}



function populate_proj_site_list(data, index){

all_proj_site.push(data.id);

    var new_proj_site_list = '<li class="col-md-12" id="'+data.id+'proj_site_li">'+
                    '<label class="custom-control margin-top user-checkbox custom-checkbox">'+
                      '<input type="checkbox" class="custom-control-input" onclick="checkifproj_siteisselected('+ data.id +')">'+
                      '<span class="custom-control-indicator"></span>'+
                      '<span class="custom-control-description">'+
                        '<div class="project-item-wrap clearfix">'+
                          '<div class="project-logo">'+
                            '<img src="'+ data.logo +'" alt="" width="50" height="50">'+
                          '</div>'+
                          '<div class="project-basic-info">'+
                            '<h4>' + data.name + '</h4>'+
                            '<p>'+ data.type_label +'</p>'+
                          '</div>'+
                        '</div>'+
                        // '<a href="#" title="" class="btn btn-xs btn-block btn-primary">Details</a>'+
                      '</span>'+
                    '</label>'+
                  '</li>';
    // var div = document.getElementById('notifications');

    // div.innerHTML += new_li;
    speed_proj_site = speed_proj_site+200;

$(new_proj_site_list).appendTo("#multi-ass-proj_site");
$("#"+data.id+"proj_site_li").fadeIn(speed_proj_site);
}

///////////////---- Multiple Select / Unselect

function selectall(type){
  if(type=="users"){
  selected_users = all_users;
  $('#multi-ass-users').find(':checkbox').each(function(){
        $(this).attr('checked', true); 
   });

  }

  else if(type=="proj_site"){
    selected_proj_site = all_proj_site;
    $('#multi-ass-proj_site').find(':checkbox').each(function(){
        $(this).attr('checked', true); 
   });
 }
}

function unselectall(type){
  if(type=="users"){
  selected_users = [];
    $('#multi-ass-users').find(':checkbox').each(function(){
        $(this).attr('checked', false); 
   });
  }
  
  else if(type=="proj_site"){
    selected_proj_site = [];
    $('#multi-ass-proj_site').find(':checkbox').each(function(){
        $(this).attr('checked', false); 
   });
  }
}


///////////////////------ Unassign / Assign individually checked list


function checkifuserisselected(id){

  res = selected_users.indexOf(id);
  if(res > -1){
    selected_users.splice(res, 1);
  }
  else{
    selected_users.push(id);
  }
  console.log(selected_users);
}

function checkifproj_siteisselected(id){

  res = selected_proj_site.indexOf(id);
  if(res > -1){
    selected_proj_site.splice(res, 1);
  }
  else{
    selected_proj_site.push(id);
  }
    console.log(selected_proj_site);
}


////////////////// - -------- Finally Send request to server.


function assignusers(url){

      group = $( 'input[id=group]:checked' ).val();
      alert(group);
      alert(selected_users);
      alert(selected_proj_site);
      $.ajax({
        url:url,
        data: {'users[]': selected_users, 'proj_site[]':selected_proj_site, 'group':group, 'csrfmiddlewaretoken': '{{ csrf_token }}'},
        type: 'POST',
        success: function (html) {
           $('#update-next-step').html(html);
        }

});
    }


</script>
    {% endblock %}
