{% extends "fieldsight/fieldsight_base1.html" %}
{% load i18n staticfiles %}
{% load filters %}
{% block kocript %}
<link rel="stylesheet" href="{% static 'css/toastr.css' %}">
<script type="text/javascript" src="{{ STATIC_URL }}js/fieldsight/plugin/toastr.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/jquery.blockUI.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/fieldsight/App.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}js/fieldsight/manage_people_site.js"></script>

<script>

$(document).ready(function() {
var pk = "{{pk}}";
var level = "{{level}}";
var organization = "{{organization}}";
vm = new ManagePeopleViewModel(pk, level, organization);
 ko.applyBindings(vm);
});

</script>
{% endblock %}
{% block content %}




			<div id="main-content" class="padding">
				<div class="row" data-bind="with:siteVm ,visible: currentVm() == 'site'" style="display:none;">



					<div class="col-md-8">
						<div class="widget-info margin-top bg-white padding">
							<div class="widget-head">
								<h4>Site Users</h4>
							</div>
							<div class="widget-body">
								<form>
									<div class="input-group">
										<input type="text" class="form-control" placeholder="Invite to..." aria-label="Invite to...">
										<span class="input-group-btn">
											<button class="btn btn-primary" type="button"><i class="la la-user-plus"></i> Invite</button>
										</span>
									</div>
								</form>


               
								<h4 class="text-center margin-top">
								<strong>OR</strong>
								</h4>
								<p class="text-center">
								Select from available Users
								</p>
								<form class="margin-top">
									<div class="input-group">
										<input type="text" class="form-control" placeholder="Search..." aria-label="Search...">
									</div>
								</form>
								<ul class="row max-260-scroll">
									<li class="col-md-4">
										<label class="custom-control margin-top user-checkbox custom-checkbox">
											<input type="checkbox" class="custom-control-input" checked>
											<span class="custom-control-indicator"></span>
											<span class="custom-control-description">
												<div class="project-item-wrap clearfix">
													<div class="project-logo">
														<img src="assets/img/img-avatar.jpg" alt="" width="50" height="50">
													</div>
													<div class="project-basic-info">
														<h4>Bikrant Giri</h4>
														<p>Old Baneshwor, Kathmandu, Nepal</p>
													</div>
												</div>
												<a href="#" title="" class="btn btn-xs btn-block btn-primary">Details</a>
											</span>
										</label>
									</li>
									
									<li class="clearfix"></li>
								</ul>
								<div class="margin-top">
								3 Users Selected.<br/>
								<button type="submit" class="btn btn-primary margin-top"><i class="la la-user-plus"></i> Assign Managers</button>
								</div>

							</div>
						</div>
					</div>
					<div class="col-md-4">
						<div class="widget-info margin-top bg-white padding">
							<div class="widget-head">
								<h4>Current Project Managers</h4>
							</div>
							<div class="widget-body max-513-scolling" data-bind="foreach:admins">
								<div class="project-item-wrap clearfix">
                	<div class="project-logo">
										<img src="assets/img/img-avatar.jpg" alt="" width="50" height="50">
									</div>
									<div class="project-basic-info">
										<h4>Bikrant Giri</h4>
										<p>Old Baneshwor, Kathmandu, Nepal</p>
									</div>
									<a href="#" title="" class="btn btn-danger btn-sm project-action"><i class="la la-close"></i></a>
								</div>
								
						</div>
					</div>
				</div>
        


			<!-- 	<div class="row">
					<div class="col-md-6">
						<div class="widget-info margin-top bg-white padding">
							<div class="widget-head">
								<h4>Users</h4>
							</div>
							<div class="widget-body">
								<ul class="row max-260-scroll">
									<li class="col-md-6">
										<label class="custom-control margin-top user-checkbox custom-checkbox">
											<input type="checkbox" class="custom-control-input" checked>
											<span class="custom-control-indicator"></span>
											<span class="custom-control-description">
												<div class="project-item-wrap clearfix">
													<div class="project-logo">
														<img src="assets/img/img-avatar.jpg" alt="" width="50" height="50">
													</div>
													<div class="project-basic-info">
														<h4>Bikrant Giri</h4>
														<p>Old Baneshwor, Kathmandu, Nepal</p>
													</div>
												</div>
												<a href="#" title="" class="btn btn-xs btn-block btn-primary">Details</a>
											</span>
										</label>
									</li>
									<li class="col-md-6">
										<label class="custom-control margin-top user-checkbox custom-checkbox">
											<input type="checkbox" class="custom-control-input" checked>
											<span class="custom-control-indicator"></span>
											<span class="custom-control-description">
												<div class="project-item-wrap clearfix">
													<div class="project-logo">
														<img src="assets/img/img-avatar.jpg" alt="" width="50" height="50">
													</div>
													<div class="project-basic-info">
														<h4>Bikrant Giri</h4>
														<p>Old Baneshwor, Kathmandu, Nepal</p>
													</div>
												</div>
												<a href="#" title="" class="btn btn-xs btn-block btn-primary">Details</a>
											</span>
										</label>
									</li>
									<li class="clearfix"></li>
									<li class="col-md-6">
										<label class="custom-control margin-top user-checkbox custom-checkbox">
											<input type="checkbox" class="custom-control-input" checked>
											<span class="custom-control-indicator"></span>
											<span class="custom-control-description">
												<div class="project-item-wrap clearfix">
													<div class="project-logo">
														<img src="assets/img/img-avatar.jpg" alt="" width="50" height="50">
													</div>
													<div class="project-basic-info">
														<h4>Bikrant Giri</h4>
														<p>Old Baneshwor, Kathmandu, Nepal</p>
													</div>
												</div>
												<a href="#" title="" class="btn btn-xs btn-block btn-primary">Details</a>
											</span>
										</label>
									</li>
									<li class="col-md-6">
										<label class="custom-control margin-top user-checkbox custom-checkbox">
											<input type="checkbox" class="custom-control-input" checked>
											<span class="custom-control-indicator"></span>
											<span class="custom-control-description">
												<div class="project-item-wrap clearfix">
													<div class="project-logo">
														<img src="assets/img/img-avatar.jpg" alt="" width="50" height="50">
													</div>
													<div class="project-basic-info">
														<h4>Bikrant Giri</h4>
														<p>Old Baneshwor, Kathmandu, Nepal</p>
													</div>
												</div>
												<a href="#" title="" class="btn btn-xs btn-block btn-primary">Details</a>
											</span>
										</label>
									</li>
									<li class="clearfix"></li>
									<li class="col-md-6">
										<label class="custom-control margin-top user-checkbox custom-checkbox">
											<input type="checkbox" class="custom-control-input" checked>
											<span class="custom-control-indicator"></span>
											<span class="custom-control-description">
												<div class="project-item-wrap clearfix">
													<div class="project-logo">
														<img src="assets/img/img-avatar.jpg" alt="" width="50" height="50">
													</div>
													<div class="project-basic-info">
														<h4>Bikrant Giri</h4>
														<p>Old Baneshwor, Kathmandu, Nepal</p>
													</div>
												</div>
												<a href="#" title="" class="btn btn-xs btn-block btn-primary">Details</a>
											</span>
										</label>
									</li>
									<li class="col-md-6">
										<label class="custom-control margin-top user-checkbox custom-checkbox">
											<input type="checkbox" class="custom-control-input" checked>
											<span class="custom-control-indicator"></span>
											<span class="custom-control-description">
												<div class="project-item-wrap clearfix">
													<div class="project-logo">
														<img src="assets/img/img-avatar.jpg" alt="" width="50" height="50">
													</div>
													<div class="project-basic-info">
														<h4>Bikrant Giri</h4>
														<p>Old Baneshwor, Kathmandu, Nepal</p>
													</div>
												</div>
												<a href="#" title="" class="btn btn-xs btn-block btn-primary">Details</a>
											</span>
										</label>
									</li>
								</ul>
							</div>
						</div>
					</div>
					<div class="col-md-6">
						<div class="widget-info margin-top bg-white padding">
							<div class="widget-head">
								<h4>Organization</h4>
							</div>
							<div class="widget-body">
								<ul class="row max-260-scroll">
									<li class="col-md-6">
										<label class="custom-control margin-top user-checkbox custom-checkbox">
											<input type="checkbox" class="custom-control-input" checked>
											<span class="custom-control-indicator"></span>
											<span class="custom-control-description">
												<div class="project-item-wrap clearfix">
													<div class="project-logo">
														<img src="assets/img/logo-org1.jpg" alt="" width="50" height="50">
													</div>
													<div class="project-basic-info">
														<h4>Organization Name</h4>
														<p>Old Baneshwor, Kathmandu, Nepal</p>
													</div>
												</div>
												<a href="#" title="" class="btn btn-xs btn-block btn-primary">Details</a>
											</span>
										</label>
									</li>
									<li class="col-md-6">
										<label class="custom-control margin-top user-checkbox custom-checkbox">
											<input type="checkbox" class="custom-control-input" checked>
											<span class="custom-control-indicator"></span>
											<span class="custom-control-description">
												<div class="project-item-wrap clearfix">
													<div class="project-logo">
														<img src="assets/img/logo-org1.jpg" alt="" width="50" height="50">
													</div>
													<div class="project-basic-info">
														<h4>Organization Name</h4>
														<p>Old Baneshwor, Kathmandu, Nepal</p>
													</div>
												</div>
												<a href="#" title="" class="btn btn-xs btn-block btn-primary">Details</a>
											</span>
										</label>
									</li>
									<li class="clearfix"></li>
									<li class="col-md-6">
										<label class="custom-control margin-top user-checkbox custom-checkbox">
											<input type="checkbox" class="custom-control-input" checked>
											<span class="custom-control-indicator"></span>
											<span class="custom-control-description">
												<div class="project-item-wrap clearfix">
													<div class="project-logo">
														<img src="assets/img/logo-org1.jpg" alt="" width="50" height="50">
													</div>
													<div class="project-basic-info">
														<h4>Organization Name</h4>
														<p>Old Baneshwor, Kathmandu, Nepal</p>
													</div>
												</div>
												<a href="#" title="" class="btn btn-xs btn-block btn-primary">Details</a>
											</span>
										</label>
									</li>
									<li class="col-md-6">
										<label class="custom-control margin-top user-checkbox custom-checkbox">
											<input type="checkbox" class="custom-control-input" checked>
											<span class="custom-control-indicator"></span>
											<span class="custom-control-description">
												<div class="project-item-wrap clearfix">
													<div class="project-logo">
														<img src="assets/img/logo-org1.jpg" alt="" width="50" height="50">
													</div>
													<div class="project-basic-info">
														<h4>Organization Name</h4>
														<p>Old Baneshwor, Kathmandu, Nepal</p>
													</div>
												</div>
												<a href="#" title="" class="btn btn-xs btn-block btn-primary">Details</a>
											</span>
										</label>
									</li>
									<li class="clearfix"></li>
									<li class="col-md-6">
										<label class="custom-control margin-top user-checkbox custom-checkbox">
											<input type="checkbox" class="custom-control-input" checked>
											<span class="custom-control-indicator"></span>
											<span class="custom-control-description">
												<div class="project-item-wrap clearfix">
													<div class="project-logo">
														<img src="assets/img/logo-org1.jpg" alt="" width="50" height="50">
													</div>
													<div class="project-basic-info">
														<h4>Organization Name</h4>
														<p>Old Baneshwor, Kathmandu, Nepal</p>
													</div>
												</div>
												<a href="#" title="" class="btn btn-xs btn-block btn-primary">Details</a>
											</span>
										</label>
									</li>
									<li class="col-md-6">
										<label class="custom-control margin-top user-checkbox custom-checkbox">
											<input type="checkbox" class="custom-control-input" checked>
											<span class="custom-control-indicator"></span>
											<span class="custom-control-description">
												<div class="project-item-wrap clearfix">
													<div class="project-logo">
														<img src="assets/img/logo-org1.jpg" alt="" width="50" height="50">
													</div>
													<div class="project-basic-info">
														<h4>Organization Name</h4>
														<p>Old Baneshwor, Kathmandu, Nepal</p>
													</div>
												</div>
												<a href="#" title="" class="btn btn-xs btn-block btn-primary">Details</a>
											</span>
										</label>
									</li>
								</ul>
							</div>
						</div>
					</div>
				</div> -->
				<!-- <div class="margin-top">
					<div class="padding bg-white">
						<button type="submit" class="btn btn-primary btn-block"><i class="la la-user-plus"></i> Assign Users</button>
					</div>
				</div> -->
			</div>



      <!-- for project -->

      <div class="row" data-bind="with:projectVm ,visible: currentVm() == 'project'" style="display:none;">



          <div class="col-md-8">
            <div class="widget-info margin-top bg-white padding">
              <div class="widget-head">
                <h4>Project Managers</h4>
              </div>
              <div class="widget-body">
                <form>
                  <div class="input-group">
                    <input type="text" class="form-control" placeholder="Invite to..." aria-label="Invite to...">
                    <span class="input-group-btn">
                      <button class="btn btn-primary" type="button"><i class="la la-user-plus"></i> Invite</button>
                    </span>
                  </div>
                </form>


               
                <h4 class="text-center margin-top">
                <strong>OR</strong>
                </h4>
                <p class="text-center">
                Select from available Users
                </p>
                <form class="margin-top">
                  <div class="input-group">
                    <input type="text" class="form-control" placeholder="Search..." aria-label="Search...">
                  </div>
                </form>
                <ul class="row max-260-scroll">
                  <li class="col-md-4">
                    <label class="custom-control margin-top user-checkbox custom-checkbox">
                      <input type="checkbox" class="custom-control-input" checked>
                      <span class="custom-control-indicator"></span>
                      <span class="custom-control-description">
                        <div class="project-item-wrap clearfix">
                          <div class="project-logo">
                            <img src="assets/img/img-avatar.jpg" alt="" width="50" height="50">
                          </div>
                          <div class="project-basic-info">
                            <h4>Bikrant Giri</h4>
                            <p>Old Baneshwor, Kathmandu, Nepal</p>
                          </div>
                        </div>
                        <a href="#" title="" class="btn btn-xs btn-block btn-primary">Details</a>
                      </span>
                    </label>
                  </li>
                  
                  <li class="clearfix"></li>
                </ul>
                <div class="margin-top">
                3 Users Selected.<br/>
                <button type="submit" class="btn btn-primary margin-top"><i class="la la-user-plus"></i> Assign Managers</button>
                </div>

              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="widget-info margin-top bg-white padding">
              <div class="widget-head">
                <h4>Current Project Users</h4>
              </div>
              <div class="widget-body max-513-scolling" data-bind="foreach:admins">
                <div class="project-item-wrap clearfix">
                  <div class="project-logo">
                    <img src="assets/img/img-avatar.jpg" alt="" width="50" height="50">
                  </div>
                  <div class="project-basic-info">
                    <h4>Bikrant Giri</h4>
                    <p>Old Baneshwor, Kathmandu, Nepal</p>
                  </div>
                  <a href="#" title="" class="btn btn-danger btn-sm project-action"><i class="la la-close"></i></a>
                </div>
                
            </div>
          </div>
        </div>
        </div>


 <!-- for project -->

      <div class="row" data-bind="with:orgVm, visible: currentVm() == 'organization'" style="display:none;">



          <div class="col-md-8">
            <div class="widget-info margin-top bg-white padding">
              <div class="widget-head">
                <h4>Organization Users</h4>
              </div>
              <div class="widget-body">
                <form>
                  <div class="input-group">
                    <input type="text" class="form-control" placeholder="Invite to..." aria-label="Invite to...">
                    <span class="input-group-btn">
                      <button class="btn btn-primary" type="button"><i class="la la-user-plus"></i> Invite</button>
                    </span>
                  </div>
                </form>


               
                <h4 class="text-center margin-top">
                <strong>OR</strong>
                </h4>
                <p class="text-center">
                Select from available Users
                </p>
                <form class="margin-top">
                  <div class="input-group">
                    <input type="text" class="form-control" placeholder="Search..." aria-label="Search...">
                  </div>
                </form>
                <ul class="row max-260-scroll">
                  <li class="col-md-4">
                    <label class="custom-control margin-top user-checkbox custom-checkbox">
                      <input type="checkbox" class="custom-control-input" checked>
                      <span class="custom-control-indicator"></span>
                      <span class="custom-control-description">
                        <div class="project-item-wrap clearfix">
                          <div class="project-logo">
                            <img src="assets/img/img-avatar.jpg" alt="" width="50" height="50">
                          </div>
                          <div class="project-basic-info">
                            <h4>Bikrant Giri</h4>
                            <p>Old Baneshwor, Kathmandu, Nepal</p>
                          </div>
                        </div>
                        <a href="#" title="" class="btn btn-xs btn-block btn-primary">Details</a>
                      </span>
                    </label>
                  </li>
                  
                  <li class="clearfix"></li>
                </ul>
                <div class="margin-top">
                3 Users Selected.<br/>
                <button type="submit" class="btn btn-primary margin-top"><i class="la la-user-plus"></i> Assign Managers</button>
                </div>

              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="widget-info margin-top bg-white padding">
              <div class="widget-head">
                <h4>Current Project Managers</h4>
              </div>
              <div class="widget-body max-513-scolling" data-bind="foreach:admins">
                <div class="project-item-wrap clearfix">
                  <div class="project-logo">
                    <img src="assets/img/img-avatar.jpg" alt="" width="50" height="50">
                  </div>
                  <div class="project-basic-info">
                    <h4>Bikrant Giri</h4>
                    <p>Old Baneshwor, Kathmandu, Nepal</p>
                  </div>
                  <a href="#" title="" class="btn btn-danger btn-sm project-action"><i class="la la-close"></i></a>
                </div>
                
            </div>
          </div>
        </div>
        </div>






	{% endblock %}
    {%block extrascript %}
       <script>
			$(document).ready(function(){

				$(".max-513-scolling").niceScroll({cursorborder:"",cursorcolor:"#00628e"});
				$(".max-260-scroll").niceScroll({cursorborder:"",cursorcolor:"#00628e"});

			});
		</script>
    <script>
var ajax_call=false;

function refresh(){
  var email = $("#invite_email").val();
  var atherate = email.indexOf("@");
      // if(atherate == -1 ){ return false; }
      var dot = email.indexOf(".", atherate);
      // if(dot == -1 ){ return false; }
      // ajax_call=true;
      // checkemail(email);
      if(atherate != -1 && dot != -1){
        ajax_call = true;
        checkemail(email);
      }
      else{
        alert("Enter valid email address.")
      }
}


 $('#invite_email').keydown(function(e) {
      var email = $("#invite_email").val();
     
      // if(ajax_call == true){ return false; }
       var atherate = email.indexOf("@");
      // if(atherate == -1 ){ return false; }
      var dot = email.indexOf(".", atherate);
      // if(dot == -1 ){ return false; }
      // ajax_call=true;
      // checkemail(email);
      if(ajax_call != true && atherate != -1 && dot != -1){
        ajax_call = true;
        checkemail(email);
      }   
    });

 // $("#invite_email").keydown(function(e) {

 //      var email = $("#invite_email").val();
 //      console.log(email);
 //      if(ajax_call == true){ return false; }
 //      var atherate = email.indexOf("@");
 //      if(atherate == -1 ){ return false; }
 //      var dot = email.indexOf(".", atherate);
 //      if(dot == -1 ){ return false; }
 //      ajax_call=true;
 //      checkemail(email);
 //    });
  function checkemail(email){
        $.ajax({
        url: "{% url 'fieldsight:check-email-for-invite' %}",
        data: {'email': email, 'csrfmiddlewaretoken': '{{ csrf_token }}'},
        type: 'POST',
        success: function (html) {
           $('#update-next-step').html(html);
           $('#retry').show();
        }
      });
  }

function sendnewuserinvite(){
  var email = $("#invite_email").val();
  sendinvite(email);
}
      

  </script>
{% if category == "site" %}

<script>
  function sendinvite(email){ 
      var organization_id = $("#invite_organization_id").val();
      var project_id = $("#invite_project_id").val();
      var site_id = $("#invite_site_id").val();
      var group =  $( 'input[id=invite_group]:checked' ).val();
      alert(group);
      console.log(group);
      $.ajax({
        url: "{% url 'fieldsight:senduserinvite' %}",
        data: {'email': email, 'organization_id':organization_id,'project_id':project_id,'site_id':site_id,'group':group, 'csrfmiddlewaretoken': '{{ csrf_token }}'},
        type: 'POST',
        success: function (html) {
           $('#update-next-step').html(html);
        }
      });
    }
</script>
{% else %}
<script>
  function sendinvite(email){ 
      var organization_id = $("#invite_organization_id").val();
      var project_id = $("#invite_project_id").val();
      var site_id = $("#invite_site_id").val();
      var group =  $("#invite_group").val();
      alert(group);
      console.log(group);
      $.ajax({
        url: "{% url 'fieldsight:senduserinvite' %}",
        data: {'email': email, 'organization_id':organization_id,'project_id':project_id,'site_id':site_id,'group':group, 'csrfmiddlewaretoken': '{{ csrf_token }}'},
        type: 'POST',
        success: function (html) {
           $('#update-next-step').html(html);
        }
      });
}
</script>
{% endif %}
    {% endblock %}
