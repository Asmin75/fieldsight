{% extends "fieldsight/fieldsight_base.html" %}
{% load i18n staticfiles %}
{% load filters %}
{% block page-title %}{% trans 'Dashboard' %}{% endblock %}

{%block extracss %}
    
    <link rel="stylesheet" href="{% static 'css/leaflet.css' %}"></link>
    <link rel="stylesheet" href="{% static 'css/MarkerCluster.css' %}"></link>
    <link rel="stylesheet" href="{% static 'css/MarkerCluster.Default.css' %}"></link>
{% endblock %}

{% block content %}


<div class="row">
  <div class="map-container-fieldsight">
    <div id="map"></div>  
  </div>  
</div>

{% endblock %}

{% block total_users %}
<div class="row">
    <div class="col-md-3">
        <div class="mini-stat clearfix">
            <span class="mini-stat-icon orange"><i class="fa fa-users"></i></span>
            <div class="mini-stat-info">
                <span>{{total_users}}</span>
                Total Users
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="mini-stat clearfix">
            <span class="mini-stat-icon tar"><i class="fa fa-building-o"></i></span>
            <div class="mini-stat-info">
                <span>{{total_organizations}}</span>
                Total Organizations
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="mini-stat clearfix">
            <span class="mini-stat-icon pink"><i class="fa fa-building-o"></i></span>
            <div class="mini-stat-info">
                <span>{{total_projects}}</span>
                Total Projects
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="mini-stat clearfix">
            <span class="mini-stat-icon green"><i class="fa fa-picture-o"></i></span>
            <div class="mini-stat-info">
                <span>{{total_sites}}</span>
                Total Sites
            </div>
        </div>
    </div>
</div>
{% endblock %}


{% block all_flagged_forms %}
  <div class="row">

    <div class="col-md-3">
        <div class="mini-flagged-forms yellow-flagged">
            <div class="mini-stat-info">
                <span><!-- {{flagged_forms}} -->12</span>
                Flagged forms
            </div>        
        </div>
    </div>
    <div class="col-md-3">
        <div class="mini-flagged-forms green-flagged">
            <div class="mini-stat-info">
                <span><!-- {{approved_froms}} -->13</span>
                Approved froms
            </div>        
        </div>
    </div>
    <div class="col-md-3">
        <div class="mini-flagged-forms red-flagged">
            <div class="mini-stat-info">
                <span><!-- {{rejected_forms}} -->14</span>
                Rejected forms
            </div>        
        </div>
    </div>
    <div class="col-md-3">
        <div class="mini-flagged-forms purple-flagged">
            <div class="mini-stat-info">
                <span><!-- {{outstanding_forms}} -->15</span>
                outstanding forms
            </div>        
        </div>
    </div>  


  </div>
{% endblock %}

{%block extrascript %}
    <script type="text/javascript" src="{{ STATIC_URL }}js/map/leaflet.js"></script>
    
    <script type="text/javascript" src="{{ STATIC_URL }}js/map/leaflet.ajax.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/map/textLabel.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/map/leaflet.markercluster-src.js"></script>
    
    <script src="http://maps.google.com/maps/api/js?v=3&key=AIzaSyC8uXN1u5FYIaGOUnVK90Rh3wR2Gmyw1uU"></script>

    <script type="text/javascript">
    $(document).ready(function(){
    console.log("inside ready");    
    });
    var static_url ="{{ STATIC_URL }}";
    
    </script>
    <script type="text/javascript">
    
    function init(){
        // console.log("inside ready");
        var map = L.map("map", {
                center: [27.73672, 85.31942],
                zoom: 7
        });
        
        var osm = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'
        });
        
        googleStreets = L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}',{
            maxZoom: 20,
            subdomains:['mt0','mt1','mt2','mt3']
        });
        googleHybrid = L.tileLayer('http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}',{
            maxZoom: 20,
            subdomains:['mt0','mt1','mt2','mt3']
        });
        googleSat = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',{
            maxZoom: 20,
            subdomains:['mt0','mt1','mt2','mt3']
        });
        googleTerrain = L.tileLayer('http://{s}.google.com/vt/lyrs=p&x={x}&y={y}&z={z}',{
            maxZoom: 20,
            subdomains:['mt0','mt1','mt2','mt3']
        });
        
        var baseLayers = {
            "OpenStreetMap": osm,
            "Google Streets": googleStreets,
            "Google Hybrid": googleHybrid,
            "Google Satellite": googleSat,
            "Google Terrain": googleTerrain
        };
        
        map.addLayer(osm);
        layerswitcher = L.control.layers(baseLayers, {}, {collapsed: true}).addTo(map);
        var markers = L.markerClusterGroup();
        
        
        var geojson = {"type": "FeatureCollection", "crs": {"type": "name", "properties": {"name": "EPSG:4326"}}, "features": [{"geometry": {"type": "Point", "coordinates": [85.324, 27.7172]}, "type": "Feature", "properties": {"public_desc": "boarding", "name": "SChulla chulla bes", "address": "ktm"}}, {"geometry": {"type": "Point", "coordinates": [85.324, 27.7172]}, "type": "Feature", "properties": {"public_desc": "Hospital for public", "name": "Helping Hand", "address": "chabahel"}}, {"geometry": {"type": "Point", "coordinates": [85.324, 27.7172]}, "type": "Feature", "properties": {"public_desc": "naxa", "name": "Naxa site", "address": "nagpokhari"}}, {"geometry": {"type": "Point", "coordinates": [85.324, 27.7172]}, "type": "Feature", "properties": {"public_desc": "park", "name": "Park site", "address": "fasdf"}}, {"geometry": {"type": "Point", "coordinates": [85.324, 27.7172]}, "type": "Feature", "properties": {"public_desc": "fieldsight", "name": "fieldsight sight", "address": "kathmandu"}}]};
        
        
        
        geoJsonLayer = new L.geoJson(geojson, {
            pointToLayer: function(feature, latlng) {
                icon = L.icon({
                                //iconSize: [27, 27],
                                iconAnchor: [13, 27],
                                popupAnchor:  [1, -24],
                                iconUrl: './css/images/marker-icon.png'
                                });
                //console.log(icon.options);
                var marker = L.marker(latlng, {icon: icon});
                return marker;
                
            }, 
            onEachFeature: function(feature, layer) {
                layer.bindPopup(feature.properties.public_desc+'<br/>'+feature.properties.name+'<br/>'+feature.properties.address);
                
            }
        });
        
        markers.addLayer(geoJsonLayer);
        map.addLayer(markers);
        
        layerswitcher.addOverlay(markers, "Schools");

    };
    </script>
{% endblock %}





  



