{% extends "fieldsight/fieldsight_base.html" %}
{% load i18n staticfiles %}
{% load filters %}

{% block page-title %}{% trans 'Organizations' %}{% endblock %}


{%block extracss %}
    
    <link rel="stylesheet" href="{% static 'css/leaflet.css' %}"></link>
    <link rel="stylesheet" href="{% static 'css/MarkerCluster.css' %}"></link>
    <link rel="stylesheet" href="{% static 'css/MarkerCluster.Default.css' %}"></link>
{% endblock %}


{% block head %}
    <a class="btn btn-success btn-raised" href="{% url 'fieldsight:organization-add' %}">{% trans 'New' %} {% trans 'Organization' %}</a>
{% endblock %}

{% block content %}

    <div class="row">
      <div class="map-container-fieldsight">
        <div id="map"></div>  
      </div>  
    </div>


    {% load pagination_tags %}
    {% load sorting_tags %}
    {% load filters %}




    <div class="adv-table">


        {% autosort object_list as sorted_objects %}
        {% autopaginate object_list 25 as paginated_objects %}

        <table class="table table-striped" id="dynamic-table1">
            <thead>
            <th>{% anchor name _('Name') %}</th>
            <th>{% anchor country _('Country') %}</th>
            <th>{% anchor address _('Address') %}</th>
            <th>{% anchor phone _('Phone') %}</th>
            <th>{% anchor fax _('Fax') %}</th>
            <th>{% anchor website _('Website') %}</th>
            <th>Organization Admins</th>
            <th>{% anchor is_active _('Status') %}</th>
            </thead>
            <tbody>
            {% for obj in paginated_objects %}
                <tr>
                    <td>
                        <a href="{% url 'fieldsight:organization-edit' obj.pk %}">{{ obj.name }}</a>
                    </td>
                    <td>
                        {{ obj.get_country_display }}
                    </td>
                    <td>
                        {{ obj.address }}
                    </td>
                    <td>
                        {{ obj.phone }}
                    </td>
                    <td>
                        {{ obj.fax }}
                    </td>
                    <td>
                        {{ obj.website }}
                    </td>
                    <td>
                        {{ obj.get_staffs }}<a class="fa fa-plus" title="Add organization Admin"
                                               href="{% url 'fieldsight:add_org_admin' pk=obj.id %}"></a>
                    </td>
                    <td>
                        {{ obj.is_active|activeness }}
                    </td>
                     <td>
                        <a class="btn btn-success btn-raised" href="{% url 'fieldsight:alter_org_status' pk=obj.id %}">
                            <!--later with js framework ko in some and angular in some-->
                            {{ obj.is_active|alter_status }} {% trans 'Org' %}</a>
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
  

        {% paginate %}

    </div>



{% endblock %}


{%block extrascript %}
    <script type="text/javascript" src="{{ STATIC_URL }}js/map/leaflet.js"></script>
    
    <script type="text/javascript" src="{{ STATIC_URL }}js/map/leaflet.ajax.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/map/textLabel.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/map/leaflet.markercluster-src.js"></script>
    
    <script src="http://maps.google.com/maps/api/js?v=3&key=AIzaSyC8uXN1u5FYIaGOUnVK90Rh3wR2Gmyw1uU"></script>
    <script type="text/javascript">
           $(document).ready(function(){
               alert('hi there');
           });
   </script>
    
    <script type="text/javascript">
    
    function init(){
        // console.log("inside ready");
        var map = L.map("map", {
                center: [27.73672, 85.31942],
                zoom: 7
        });
        
        var osm = L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'
        });
        
        googleStreets = L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}',{
            maxZoom: 20,
            subdomains:['mt0','mt1','mt2','mt3']
        });
        googleHybrid = L.tileLayer('http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}',{
            maxZoom: 20,
            subdomains:['mt0','mt1','mt2','mt3']
        });
        googleSat = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',{
            maxZoom: 20,
            subdomains:['mt0','mt1','mt2','mt3']
        });
        googleTerrain = L.tileLayer('http://{s}.google.com/vt/lyrs=p&x={x}&y={y}&z={z}',{
            maxZoom: 20,
            subdomains:['mt0','mt1','mt2','mt3']
        });
        
        var baseLayers = {
            "OpenStreetMap": osm,
            "Google Streets": googleStreets,
            "Google Hybrid": googleHybrid,
            "Google Satellite": googleSat,
            "Google Terrain": googleTerrain
        };
        
        map.addLayer(osm);
        layerswitcher = L.control.layers(baseLayers, {}, {collapsed: true}).addTo(map);
        var markers = L.markerClusterGroup();
        
        
        var geojson = {"type": "FeatureCollection", "crs": {"type": "name", "properties": {"name": "EPSG:4326"}}, "features": [{"geometry": {"type": "Point", "coordinates": [85.324, 27.7172]}, "type": "Feature", "properties": {"public_desc": "boarding", "name": "SChulla chulla bes", "address": "ktm"}}, {"geometry": {"type": "Point", "coordinates": [85.324, 27.7172]}, "type": "Feature", "properties": {"public_desc": "Hospital for public", "name": "Helping Hand", "address": "chabahel"}}, {"geometry": {"type": "Point", "coordinates": [85.324, 27.7172]}, "type": "Feature", "properties": {"public_desc": "naxa", "name": "Naxa site", "address": "nagpokhari"}}, {"geometry": {"type": "Point", "coordinates": [85.324, 27.7172]}, "type": "Feature", "properties": {"public_desc": "park", "name": "Park site", "address": "fasdf"}}, {"geometry": {"type": "Point", "coordinates": [85.324, 27.7172]}, "type": "Feature", "properties": {"public_desc": "fieldsight", "name": "fieldsight sight", "address": "kathmandu"}}]};
        
        
        
        geoJsonLayer = new L.geoJson(geojson, {
            pointToLayer: function(feature, latlng) {
                icon = L.icon({
                                //iconSize: [27, 27],
                                iconAnchor: [13, 27],
                                popupAnchor:  [1, -24],
                                iconUrl: './css/images/marker-icon.png'
                                });
                //console.log(icon.options);
                var marker = L.marker(latlng, {icon: icon});
                return marker;
                
            }, 
            onEachFeature: function(feature, layer) {
                layer.bindPopup(feature.properties.public_desc+'<br/>'+feature.properties.name+'<br/>'+feature.properties.address);
                
            }
        });
        
        markers.addLayer(geoJsonLayer);
        map.addLayer(markers);
        
        layerswitcher.addOverlay(markers, "Schools");

    };
    </script>
{% endblock %}